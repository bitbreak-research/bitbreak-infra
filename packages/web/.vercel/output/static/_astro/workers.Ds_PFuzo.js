import{x as P,i as D,g as v,j as o,k as t,c,v as Q,t as $,S as C,m as z,n as ue,w as he,y as U,o as ve,F as me}from"./web.CxjjJZrc.js";import{m as X}from"./index.DmeqUQK-.js";import{$ as Y}from"./auth.YqlKLZ3z.js";import{c as $e,g as xe}from"./workers.DhJKcq-O.js";import{B as J,A as be,I as fe}from"./Alert.C455yNHf.js";import"./WorkerDetail.CFT1fLwa.js";import"./store.CsayWp_b.js";var _e=$('<div class=space-y-6><div class="flex items-center gap-3 p-4 rounded-lg bg-green-50 border border-green-200"><svg class="w-5 h-5 text-green-600 flex-shrink-0"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div><p class="text-sm font-medium text-green-800">Machine created successfully</p><p class="text-xs text-green-700 mt-0.5">Configuration file has been downloaded</p></div></div><div class=space-y-4><div><label class="block text-sm font-medium text-[var(--color-gray-700)] mb-1.5">Connection Token</label><p class="text-xs text-[var(--color-gray-500)] mb-2">Save this token securely. It will not be shown again.</p><div class="flex items-center gap-2"><code class="flex-1 px-3 py-2.5 bg-[var(--color-gray-50)] border border-[var(--color-gray-200)] rounded-lg text-xs font-mono break-all text-[var(--color-gray-900)]"></code><button class="btn btn-secondary !w-auto !py-2.5"title="Copy token"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div><button class="btn btn-secondary w-full"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>Download Config Again</button></div><div class="flex gap-3"><!$><!/><a href=/workers class="btn btn-primary flex-1 text-center">View All Machines'),ke=$(`<form class=space-y-6><!$><!/><!$><!/><p class="text-xs text-[var(--color-gray-500)]">After creation, you'll receive a configuration file to set up the worker on your Mac Mini.</p><!$><!/>`);function Oe(n){const E=X(Y),[x,M]=D(""),[y,r]=D(!1),[b,f]=D(""),[_,L]=D(null),i=async e=>{if(e.preventDefault(),f(""),r(!0),!E().isAuthenticated){f("Not authenticated"),r(!1);return}const l=await $e(x());if(l.success&&l.data){L(l.data);const d=x()||l.data.name;M(""),typeof window<"u"&&window.refreshWorkersList&&window.refreshWorkersList(),m(l.data,d),n.onWorkerCreated?.()}else f(l.error?.message||"Failed to create worker");r(!1)},m=(e,l)=>{const d={id:e.worker_id,token:e.token,websocket_url:e.websocket_url},k=l.replace(/[^a-zA-Z0-9-_]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),w=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),g=URL.createObjectURL(w),a=document.createElement("a");a.href=g,a.download=`config-${k}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(g)},A=()=>{const e=_();if(!e)return;const l=e.name||e.worker_id;m(e,l)},F=async()=>{const e=_();e?.token&&await navigator.clipboard.writeText(e.token)};return _()?(()=>{var e=v(_e),l=e.firstChild,d=l.nextSibling,k=d.firstChild,w=k.firstChild,g=w.nextSibling,a=g.nextSibling,p=a.firstChild,S=p.nextSibling,s=k.nextSibling,u=d.nextSibling,N=u.firstChild,[j,R]=o(N.nextSibling);return j.nextSibling,t(p,()=>_().token),S.$$click=F,s.$$click=A,t(u,c(J,{onClick:()=>{L(null),n.onWorkerCreated?.()},variant:"secondary",children:"Create Another"}),j,R),Q(),e})():(()=>{var e=v(ke),l=e.firstChild,[d,k]=o(l.nextSibling),w=d.nextSibling,[g,a]=o(w.nextSibling),p=g.nextSibling,S=p.nextSibling,[s,u]=o(S.nextSibling);return e.addEventListener("submit",i),t(e,c(C,{get when(){return b()},get children(){return c(be,{type:"error",get message(){return b()}})}}),d,k),t(e,c(fe,{label:"Machine Name",type:"text",get value(){return x()},onInput:N=>M(N.currentTarget.value),placeholder:"e.g., MacMini-Office-01",required:!0,minLength:3,maxLength:100,get disabled(){return y()}}),g,a),t(e,c(J,{type:"submit",get loading(){return y()},get disabled(){return y()||x().length<3},children:"Create Machine"}),s,u),e})()}P(["click"]);P(["click"]);var we=$('<span class="badge badge-success">Running'),ye=$('<span class="badge badge-neutral">Stopped'),pe=$('<div class="mt-4 pt-4 border-t border-[var(--color-gray-200)]"><div class="flex items-center justify-between"><span class="text-sm text-[var(--color-gray-500)]">Generation Rate</span><span class="text-sm font-medium text-[var(--color-gray-900)]"><!$><!/> keys/min'),Se=$('<div class="card card-interactive p-6 cursor-pointer"><div class="flex items-start justify-between mb-6"><div><h3 class="text-lg font-semibold text-[var(--color-gray-900)]"></h3><div class="flex items-center gap-2 mt-1"><span></span><span class="text-sm text-[var(--color-gray-500)]"></span></div></div><!$><!/><!$><!/></div><div class="flex justify-center mb-6"><svg class=machine-icon viewBox="0 0 100 100"fill=none><g transform="translate(15, 20)"><path d="M35 0 L70 15 L70 45 L35 30 Z"fill=#E8E8ED stroke=#D2D2D7 stroke-width=1></path><path d="M0 15 L35 0 L35 30 L0 45 Z"fill=#F5F5F7 stroke=#D2D2D7 stroke-width=1></path><path d="M0 45 L35 30 L70 45 L35 60 Z"fill=#FAFAFA stroke=#D2D2D7 stroke-width=1></path><line x1=38 y1=8 x2=62 y2=18 stroke=#D2D2D7 stroke-width=1></line><line x1=38 y1=12 x2=62 y2=22 stroke=#D2D2D7 stroke-width=1></line><line x1=38 y1=16 x2=62 y2=26 stroke=#D2D2D7 stroke-width=1></line><line x1=8 y1=20 x2=30 y2=12 stroke=#E8E8ED stroke-width=1></line><line x1=8 y1=24 x2=30 y2=16 stroke=#E8E8ED stroke-width=1></line><line x1=8 y1=28 x2=30 y2=20 stroke=#E8E8ED stroke-width=1></line></g></svg></div><div class=space-y-3><div class=metric-row><span class=metric-label>CPU</span><div class=metric-bar><div class=metric-bar-fill></div></div><span class=metric-value><!$><!/>%</span></div><div class=metric-row><span class=metric-label>Memory</span><div class=metric-bar><div class=metric-bar-fill></div></div><span class=metric-value></span></div><div class=metric-row><span class=metric-label>Storage capacity</span><div class=metric-bar><div class=metric-bar-fill></div></div><span class=metric-value><!$><!/>%</span></div></div><!$><!/>');function Ce(n){const E=()=>60,x=()=>{const r=n.worker.memory;return r===null?0:Math.min(Math.round(r/8192*100),100)},M=()=>n.worker.cpu??0,y=()=>{const r=n.worker.memory;return r===null?"--":r>=1024?`${(r/1024).toFixed(1)}GB`:`${r}MB`};return(()=>{var r=v(Se),b=r.firstChild,f=b.firstChild,_=f.firstChild,L=_.nextSibling,i=L.firstChild,m=i.nextSibling,A=f.nextSibling,[F,e]=o(A.nextSibling),l=F.nextSibling,[d,k]=o(l.nextSibling),w=b.nextSibling,g=w.nextSibling,a=g.firstChild,p=a.firstChild,S=p.nextSibling,s=S.firstChild,u=S.nextSibling,N=u.firstChild,[j,R]=o(N.nextSibling);j.nextSibling;var T=a.nextSibling,ee=T.firstChild,Z=ee.nextSibling,te=Z.firstChild,re=Z.nextSibling,ne=T.nextSibling,ie=ne.firstChild,G=ie.nextSibling,le=G.firstChild,V=G.nextSibling,ae=V.firstChild,[H,se]=o(ae.nextSibling);H.nextSibling;var oe=g.nextSibling,[ce,de]=o(oe.nextSibling);return r.$$click=()=>n.onClick?.(),t(_,()=>n.worker.name),t(m,()=>n.worker.connected?"Online":"Offline"),t(b,c(C,{get when(){return n.worker.engine_status==="running"},get children(){return v(we)}}),F,e),t(b,c(C,{get when(){return n.worker.engine_status==="stopped"||!n.worker.engine_status},get children(){return v(ye)}}),d,k),t(u,M,j,R),t(re,y),t(V,E,H,se),t(r,c(C,{get when(){return z(()=>n.worker.rate!==null)()&&n.worker.rate>0},get children(){var h=v(pe),W=h.firstChild,O=W.firstChild,B=O.nextSibling,I=B.firstChild,[q,ge]=o(I.nextSibling);return q.nextSibling,t(B,()=>n.worker.rate,q,ge),h}}),ce,de),ue(h=>{var W=`status-dot ${n.worker.connected?"online":"offline"}`,O=`width: ${M()}%`,B=`width: ${x()}%`,I=`width: ${E()}%`;return W!==h.e&&he(i,h.e=W),h.t=U(s,O,h.t),h.a=U(te,B,h.a),h.o=U(le,I,h.o),h},{e:void 0,t:void 0,a:void 0,o:void 0}),Q(),r})()}P(["click"]);var Me=$('<div class="p-4 mb-6 rounded-lg bg-red-50 border border-red-200"><p class="text-sm text-red-600">'),K=$('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">'),De=$('<div class="card p-12 text-center"><div class="w-16 h-16 mx-auto mb-4 rounded-full bg-[var(--color-gray-100)] flex items-center justify-center"><svg width=32 height=32 viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=1.5 class=text-[var(--color-gray-400)]><rect x=2 y=2 width=20 height=8 rx=2 ry=2></rect><rect x=2 y=14 width=20 height=8 rx=2 ry=2></rect><line x1=6 y1=6 x2=6.01 y2=6></line><line x1=6 y1=18 x2=6.01 y2=18></line></svg></div><h3 class="text-lg font-medium text-[var(--color-gray-900)] mb-2">No machines configured</h3><p class="text-sm text-[var(--color-gray-500)] mb-6">Add your first Mac Mini to start monitoring and generating wallets.</p><a href=/workers/new class="btn btn-primary">Add Machine'),Ee=$("<div><!$><!/><!$><!/><!$><!/><!$><!/>"),Le=$('<div class="card p-6 animate-pulse"><div class="h-6 bg-[var(--color-gray-200)] rounded w-2/3 mb-4"></div><div class="h-20 bg-[var(--color-gray-100)] rounded mb-4"></div><div class=space-y-3><div class="h-4 bg-[var(--color-gray-200)] rounded"></div><div class="h-4 bg-[var(--color-gray-200)] rounded"></div><div class="h-4 bg-[var(--color-gray-200)] rounded">');function Ie(n){const E=X(Y),[x,M]=D([]),[y,r]=D(!0),[b,f]=D(""),_=async(i=!0)=>{if(i&&r(!0),f(""),!E().isAuthenticated){f("Not authenticated"),r(!1);return}const m=await xe();m.success&&m.data?M(m.data.workers):f(m.error?.message||"Failed to load machines"),i&&r(!1)},L=i=>{n.onMachineClick?n.onMachineClick(i):window.location.href=`/workers/${i}`};return ve(()=>{_(!0);const i=setInterval(()=>{_(!1)},5e3);return()=>clearInterval(i)}),(()=>{var i=v(Ee),m=i.firstChild,[A,F]=o(m.nextSibling),e=A.nextSibling,[l,d]=o(e.nextSibling),k=l.nextSibling,[w,g]=o(k.nextSibling),a=w.nextSibling,[p,S]=o(a.nextSibling);return t(i,c(C,{get when(){return b()},get children(){var s=v(Me),u=s.firstChild;return t(u,b),s}}),A,F),t(i,c(C,{get when(){return y()},get children(){var s=v(K);return t(s,()=>[1,2,3,4].map(()=>v(Le))),s}}),l,d),t(i,c(C,{get when(){return z(()=>!y())()&&x().length===0},get children(){return v(De)}}),w,g),t(i,c(C,{get when(){return z(()=>!y())()&&x().length>0},get children(){var s=v(K);return t(s,c(me,{get each(){return x()},children:u=>c(Ce,{worker:u,onClick:()=>L(u.worker_id)})})),s}}),p,S),i})()}export{Oe as CreateWorkerForm,Ie as MachinesGrid};
