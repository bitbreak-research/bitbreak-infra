import{x as qe,i as I,l as R,o as Je,g as x,j as y,k as l,c as w,t as u,S as W,n as M,z as L,v as H,m as de,w as ge,s as m,F as Oe}from"./web.CxjjJZrc.js";import{m as Qe}from"./index.DmeqUQK-.js";import{$ as Xe}from"./auth.YqlKLZ3z.js";import{a as Ye,b as Ze,s as et,d as tt,r as rt,e as lt}from"./workers.DhJKcq-O.js";import"./store.CsayWp_b.js";var st=u('<div class="animate-pulse space-y-6"><div class="h-8 bg-[var(--color-gray-200)] rounded w-1/3"></div><div class="card p-6"><div class="h-32 bg-[var(--color-gray-100)] rounded">'),at=u('<div class="card p-6 bg-red-50 border-red-200"><p class=text-red-600>'),it=u('<button class="btn btn-primary">Start Engine'),nt=u('<button class="btn btn-secondary">Stop Engine'),ot=u('<div class="h-48 relative">'),ct=u('<div class=space-y-6><div class="flex items-center justify-between"><div><h1 class="text-2xl font-semibold text-[var(--color-gray-900)]"></h1><div class="flex items-center gap-3 mt-2"><span></span><span class="text-sm text-[var(--color-gray-500)]"></span><span class="text-sm text-[var(--color-gray-400)]">|</span><span class="text-xs font-mono text-[var(--color-gray-400)]"></span></div></div><div class="flex items-center gap-3"></div></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"><div class=stat-card><div class=stat-value><!$><!/>%</div><div class=stat-label>CPU Usage</div></div><div class=stat-card><div class=stat-value><!$><!/><span class="text-lg font-normal text-[var(--color-gray-500)]">GB</span></div><div class=stat-label>Memory Usage</div></div><div class=stat-card><div class=stat-value></div><div class=stat-label>Keys/min</div></div><div class=stat-card><div class=stat-value></div><div class=stat-label>Token Expires</div></div></div><div class="card p-6"><h2 class="text-lg font-semibold text-[var(--color-gray-900)] mb-4">Performance History</h2><!$><!/></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="card p-6"><h2 class="text-lg font-semibold text-[var(--color-gray-900)] mb-4">Machine Details</h2><dl class=space-y-4><div class="flex justify-between"><dt class="text-sm text-[var(--color-gray-500)]">Status</dt><dd class="text-sm font-medium text-[var(--color-gray-900)]"><span></span></dd></div><div class="flex justify-between"><dt class="text-sm text-[var(--color-gray-500)]">Created</dt><dd class="text-sm font-medium text-[var(--color-gray-900)]"></dd></div><div class="flex justify-between"><dt class="text-sm text-[var(--color-gray-500)]">Last IP</dt><dd class="text-sm font-mono text-[var(--color-gray-900)]"></dd></div><div class="flex justify-between"><dt class="text-sm text-[var(--color-gray-500)]">Token Expires</dt><dd class="text-sm font-medium text-[var(--color-gray-900)]"></dd></div></dl></div><div class="card p-6"><h2 class="text-lg font-semibold text-[var(--color-gray-900)] mb-4">Actions</h2><div class=space-y-3><button class="btn btn-secondary w-full justify-start"><svg width=16 height=16 viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>Regenerate Token</button><button class="btn btn-danger w-full justify-start"><svg width=16 height=16 viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>Delete Machine'),dt=u("<div><!$><!/><!$><!/><!$><!/>"),gt=u('<div class="h-48 flex items-center justify-center text-[var(--color-gray-500)]">No metrics data available'),vt=u('<svg viewBox="0 0 800 180"class="w-full h-full"><!$><!/><path fill=none stroke=var(--color-primary) stroke-width=2 stroke-linecap=round stroke-linejoin=round></path><path fill=none stroke=var(--color-gray-400) stroke-width=2 stroke-linecap=round stroke-linejoin=round stroke-dasharray=4></path><g><circle cx=0 cy=0 r=4 fill=var(--color-primary)></circle><text x=10 y=4 class="text-xs fill-[var(--color-gray-600)]">CPU</text><circle cx=60 cy=0 r=4 fill=var(--color-gray-400)></circle><text x=70 y=4 class="text-xs fill-[var(--color-gray-600)]">Rate'),xt=u("<svg><line stroke=var(--color-gray-200) stroke-dasharray=4></svg>",!1,!0,!1),ut=u('<svg><text text-anchor=end class="text-xs fill-[var(--color-gray-400)]"><!$><!/>%</svg>',!1,!0,!1);function yt(h){const N=Qe(Xe),[n,a]=I(null),[k,_]=I(null),[j,D]=I(!0),[S,r]=I(!1),[b,f]=I(""),d=async()=>{if(!N().isAuthenticated){f("Not authenticated"),D(!1);return}const[e,c]=await Promise.all([Ye(h.workerId),Ze(h.workerId,{limit:60})]);e.success&&e.data?a(e.data):f(e.error?.message||"Failed to load worker"),c.success&&c.data&&_(c.data),D(!1)},g=async()=>{r(!0);const e=await et(h.workerId);e.success||alert(e.error?.message||"Failed to start engine"),await d(),r(!1)},$=async()=>{r(!0);const e=await tt(h.workerId);e.success||alert(e.error?.message||"Failed to stop engine"),await d(),r(!1)},p=async()=>{if(!confirm("This will generate a new token. The old token will be invalidated. Continue?"))return;r(!0);const e=await rt(h.workerId);e.success&&e.data?alert(`New token: ${e.data.token}

Save this token securely. It will not be shown again.`):alert(e.error?.message||"Failed to regenerate token"),await d(),r(!1)},i=async()=>{if(!confirm("Are you sure you want to delete this worker? This action cannot be undone."))return;r(!0);const e=await lt(h.workerId);e.success?window.location.href="/workers":(alert(e.error?.message||"Failed to delete worker"),r(!1))},v=R(()=>k()?.metrics[0]||null),s=e=>e?new Date(e).toLocaleString():"--",o=e=>{const c=new Date(e),T=new Date,C=Math.ceil((c.getTime()-T.getTime())/(1e3*60*60*24));return C<0?"Expired":C<7?`${C} days`:`${C} days`};return Je(()=>{d();const e=setInterval(d,5e3);return()=>clearInterval(e)}),(()=>{var e=x(dt),c=e.firstChild,[T,C]=y(c.nextSibling),ve=T.nextSibling,[U,xe]=y(ve.nextSibling),ue=U.nextSibling,[he,fe]=y(ue.nextSibling);return l(e,w(W,{get when(){return j()},get children(){return x(st)}}),T,C),l(e,w(W,{get when(){return b()},get children(){var E=x(at),F=E.firstChild;return l(F,b),E}}),U,xe),l(e,w(W,{get when(){return de(()=>!j())()&&n()},get children(){var E=x(ct),F=E.firstChild,B=F.firstChild,V=B.firstChild,$e=V.nextSibling,z=$e.firstChild,G=z.nextSibling,me=G.nextSibling,_e=me.nextSibling,be=B.nextSibling,K=F.nextSibling,q=K.firstChild,J=q.firstChild,ye=J.firstChild,[O,pe]=y(ye.nextSibling);O.nextSibling;var Q=q.nextSibling,X=Q.firstChild,we=X.firstChild,[Y,ke]=y(we.nextSibling);Y.nextSibling;var Z=Q.nextSibling,Se=Z.firstChild,Ce=Z.nextSibling,Me=Ce.firstChild,P=K.nextSibling,je=P.firstChild,Ee=je.nextSibling,[Ie,We]=y(Ee.nextSibling),De=P.nextSibling,ee=De.firstChild,Te=ee.firstChild,Fe=Te.nextSibling,te=Fe.firstChild,Le=te.firstChild,Pe=Le.nextSibling,re=Pe.firstChild,le=te.nextSibling,Ae=le.firstChild,He=Ae.nextSibling,se=le.nextSibling,Re=se.firstChild,Ne=Re.nextSibling,Ue=se.nextSibling,Be=Ue.firstChild,Ve=Be.nextSibling,ze=ee.nextSibling,Ge=ze.firstChild,Ke=Ge.nextSibling,A=Ke.firstChild,ae=A.nextSibling;return l(V,()=>n().name),l(G,()=>n().is_connected?"Connected":"Disconnected"),l(_e,()=>h.workerId),l(be,w(W,{get when(){return n().is_connected},get children(){return[(()=>{var t=x(it);return t.$$click=g,M(()=>L(t,"disabled",S())),H(),t})(),(()=>{var t=x(nt);return t.$$click=$,M(()=>L(t,"disabled",S())),H(),t})()]}})),l(J,()=>v()?.cpu??"--",O,pe),l(X,(()=>{var t=de(()=>!!v()?.memory);return()=>t()?`${(v().memory/1024).toFixed(1)}`:"--"})(),Y,ke),l(Se,()=>v()?.rate??"--"),l(Me,()=>o(n().token_expires_at)),l(P,w(W,{get when(){return k()?.metrics.length},get fallback(){return x(gt)},get children(){var t=x(ot);return l(t,w(ht,{get metrics(){return k().metrics}})),t}}),Ie,We),l(re,()=>n().status),l(He,()=>s(n().created_at)),l(Ne,()=>n().last_ip||"--"),l(Ve,()=>s(n().token_expires_at)),A.$$click=p,ae.$$click=i,M(t=>{var ie=`status-dot ${n().is_connected?"online":"offline"}`,ne=`badge ${n().status==="active"?"badge-success":"badge-error"}`,oe=S(),ce=S();return ie!==t.e&&ge(z,t.e=ie),ne!==t.t&&ge(re,t.t=ne),oe!==t.a&&L(A,"disabled",t.a=oe),ce!==t.o&&L(ae,"disabled",t.o=ce),t},{e:void 0,t:void 0,a:void 0,o:void 0}),H(),E}}),he,fe),e})()}function ht(h){const a={top:20,right:20,bottom:30,left:50},k=800-a.left-a.right,_=180-a.top-a.bottom,j=()=>[...h.metrics].reverse(),D=R(()=>{const r=j();if(r.length<2)return"";const b=k/(r.length-1),f=_/100;return r.map((d,g)=>{const $=a.left+g*b,p=a.top+_-d.cpu*f;return`${g===0?"M":"L"} ${$} ${p}`}).join(" ")}),S=R(()=>{const r=j();if(r.length<2)return"";const b=Math.max(...r.map(g=>g.rate),100),f=k/(r.length-1),d=_/b;return r.map((g,$)=>{const p=a.left+$*f,i=a.top+_-g.rate*d;return`${$===0?"M":"L"} ${p} ${i}`}).join(" ")});return(()=>{var r=x(vt),b=r.firstChild,[f,d]=y(b.nextSibling),g=f.nextSibling,$=g.nextSibling,p=$.nextSibling;return l(r,w(Oe,{each:[0,25,50,75,100],children:i=>{const v=a.top+_-i/100*_;return[(()=>{var s=x(xt);return m(s,"y1",v),m(s,"y2",v),M(o=>{var e=a.left,c=800-a.right;return e!==o.e&&m(s,"x1",o.e=e),c!==o.t&&m(s,"x2",o.t=c),o},{e:void 0,t:void 0}),s})(),(()=>{var s=x(ut),o=s.firstChild,[e,c]=y(o.nextSibling);return e.nextSibling,m(s,"y",v+4),l(s,i,e,c),M(()=>m(s,"x",a.left-10)),s})()]}}),f,d),M(i=>{var v=D(),s=S(),o=`translate(${a.left}, 172)`;return v!==i.e&&m(g,"d",i.e=v),s!==i.t&&m($,"d",i.t=s),o!==i.a&&m(p,"transform",i.a=o),i},{e:void 0,t:void 0,a:void 0}),r})()}qe(["click"]);export{yt as default};
