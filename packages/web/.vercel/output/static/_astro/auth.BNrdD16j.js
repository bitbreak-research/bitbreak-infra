import{i as l,o as F,c as r,g as N,t as T,j as c,k as a,S as m,m as D}from"./web.CxjjJZrc.js";import{I as j,A as W,B as M}from"./Alert.C455yNHf.js";import{a as z}from"./auth.YqlKLZ3z.js";import{c as G}from"./session.ClfPWQss.js";import{c as te}from"./workers.DhJKcq-O.js";async function re(e){try{const o=await fetch(e,{method:"GET",credentials:"include"}),s=await o.json();return o.ok?{success:!0,data:s}:{success:!1,error:s.error||{code:"UNKNOWN",message:"An error occurred"}}}catch{return{success:!1,error:{code:"NETWORK",message:"Network error"}}}}async function J(e,o){try{const s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)}),d=await s.json();return s.ok?{success:!0,data:d}:{success:!1,error:d.error||{code:"UNKNOWN",message:"An error occurred"}}}catch{return{success:!1,error:{code:"NETWORK",message:"Network error"}}}}async function Y(){return re("/api/auth/status")}async function ne(e,o,s){return J("/api/auth/setup",{username:e,password:o,confirmPassword:s})}async function se(e,o){return J("/api/auth/login",{username:e,password:o})}var ae=T('<form class=space-y-6><div class="text-center mb-6"><h2 class="text-lg font-semibold text-[var(--color-gray-900)]">Sign In</h2><p class="text-sm text-[var(--color-gray-500)] mt-1">Enter your credentials to continue</p></div><div class=space-y-4><!$><!/><!$><!/></div><!$><!/><!$><!/>'),oe=T('<div class="flex items-center justify-center py-8"><svg class="animate-spin h-6 w-6 text-[var(--color-gray-400)]"xmlns=http://www.w3.org/2000/svg fill=none viewBox="0 0 24 24"><circle class=opacity-25 cx=12 cy=12 r=10 stroke=currentColor stroke-width=4></circle><path class=opacity-75 fill=currentColor d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">');function fe(e){const[o,s]=l(""),[d,p]=l(""),[b,h]=l(""),[f,w]=l(!1),[L,i]=l(!0);F(async()=>{if(await G()){window.location.href=e.redirectUrl||"/workers";return}const t=await Y();if(t.success&&t.data?.needsSetup){window.location.href="/setup";return}i(!1)});const $=async u=>{u.preventDefault(),h(""),w(!0);const t=await se(o(),d());t.success&&t.data?(z(t.data.user),window.location.href=e.redirectUrl||"/workers"):h(t.error?.message||"Login failed"),w(!1)};return r(m,{get when(){return!L()},get fallback(){return N(oe)},get children(){var u=N(ae),t=u.firstChild,n=t.nextSibling,x=n.firstChild,[g,_]=c(x.nextSibling),S=g.nextSibling,[y,P]=c(S.nextSibling),E=n.nextSibling,[k,U]=c(E.nextSibling),A=k.nextSibling,[v,O]=c(A.nextSibling);return u.addEventListener("submit",$),a(n,r(j,{label:"Username",type:"text",get value(){return o()},onInput:C=>s(C.currentTarget.value),required:!0,autocomplete:"username",placeholder:"admin"}),g,_),a(n,r(j,{label:"Password",type:"password",get value(){return d()},onInput:C=>p(C.currentTarget.value),required:!0,autocomplete:"current-password",placeholder:"Enter your password"}),y,P),a(u,r(m,{get when(){return b()},get children(){return r(W,{get message(){return b()},type:"error"})}}),k,U),a(u,r(M,{type:"submit",get loading(){return f()},children:"Sign In"}),v,O),u}})}var ce=T("<form class=space-y-6><div class=space-y-4><!$><!/><!$><!/><!$><!/></div><!$><!/><!$><!/>"),ie=T('<div class="text-center text-gray-500">Loading...');function me(){const[e,o]=l(""),[s,d]=l(""),[p,b]=l(""),[h,f]=l(""),[w,L]=l(!1),[i,$]=l(!0);F(async()=>{if(await G()){window.location.href="/workers";return}const n=await Y();if(n.success&&!n.data?.needsSetup){window.location.href="/login";return}$(!1)});const u=async t=>{if(t.preventDefault(),f(""),s()!==p()){f("Passwords do not match");return}if(s().length<8){f("Password must be at least 8 characters");return}L(!0);const n=await ne(e(),s(),p());n.success&&n.data?(z(n.data.user),window.location.href="/workers"):f(n.error?.message||"Setup failed"),L(!1)};return r(m,{get when(){return!i()},get fallback(){return N(ie)},get children(){var t=N(ce),n=t.firstChild,x=n.firstChild,[g,_]=c(x.nextSibling),S=g.nextSibling,[y,P]=c(S.nextSibling),E=y.nextSibling,[k,U]=c(E.nextSibling),A=n.nextSibling,[v,O]=c(A.nextSibling),C=v.nextSibling,[q,B]=c(C.nextSibling);return t.addEventListener("submit",u),a(n,r(j,{label:"Username",type:"text",get value(){return e()},onInput:I=>o(I.currentTarget.value),required:!0,autocomplete:"username"}),g,_),a(n,r(j,{label:"Password",type:"password",get value(){return s()},onInput:I=>d(I.currentTarget.value),required:!0,autocomplete:"new-password"}),y,P),a(n,r(j,{label:"Confirm Password",type:"password",get value(){return p()},onInput:I=>b(I.currentTarget.value),required:!0,autocomplete:"new-password"}),k,U),a(t,r(m,{get when(){return h()},get children(){return r(W,{get message(){return h()},type:"error"})}}),v,O),a(t,r(M,{type:"submit",get loading(){return w()},children:"Create Account"}),q,B),t}})}var le=T('<div class="text-center text-sm text-gray-600 py-2">'),ue=T('<div class=space-y-6><div class="text-center space-y-2"><h1 class="text-2xl font-semibold">Connect CLI</h1><p class=text-gray-600>Click the button below to connect your CLI to this account.</p><p class="text-sm text-gray-500">A new worker will be created and configured for your CLI.</p></div><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><div class="text-xs text-gray-400 text-center space-y-1"><p>Source: <!$><!/></p><p class=break-all>Callback: <!$><!/>');function pe(e){const[o,s]=l(""),[d,p]=l(!1),[b,h]=l(!1),[f,w]=l("");F(()=>{(!e.callback||!e.token)&&s("Missing required parameters (callback or token)")});const L=async()=>{s(""),p(!1),h(!0),w("Creating worker...");try{const i=`CLI Worker - ${new Date().toISOString()}`,$=await te(i);if(!$.success||!$.data){s($.error?.message||"Failed to create worker"),h(!1),w("");return}const{worker_id:u,token:t,websocket_url:n}=$.data,x={id:u,token:t,websocket_url:n};w("Connecting to CLI...");const g=new URL(e.callback);g.searchParams.set("token",e.token);const _=await fetch(g.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(_.ok)p(!0),w("Successfully connected! You can close this window.");else{const S=await _.text();s(`CLI rejected the connection: ${S||"Unknown error"}`)}}catch(i){s("Connection error. Make sure the CLI is still running."),console.error("Connection error:",i)}finally{h(!1),d()||w("")}};return(()=>{var i=N(ue),$=i.firstChild,u=$.nextSibling,[t,n]=c(u.nextSibling),x=t.nextSibling,[g,_]=c(x.nextSibling),S=g.nextSibling,[y,P]=c(S.nextSibling),E=y.nextSibling,[k,U]=c(E.nextSibling),A=k.nextSibling,[v,O]=c(A.nextSibling),C=v.nextSibling,q=C.firstChild,B=q.firstChild,I=B.nextSibling,[H,V]=c(I.nextSibling),K=q.nextSibling,Q=K.firstChild,X=Q.nextSibling,[Z,ee]=c(X.nextSibling);return a(i,r(m,{get when(){return o()},get children(){return r(W,{get message(){return o()},type:"error"})}}),t,n),a(i,r(m,{get when(){return d()},get children(){return[r(W,{message:"Successfully connected! You can close this window and return to your CLI.",type:"success"}),r(M,{onClick:()=>window.location.href="/workers",children:"Go Back to Workers"})]}}),g,_),a(i,r(m,{get when(){return f()},get children(){var R=N(le);return a(R,f),R}}),y,P),a(i,r(m,{get when(){return!e.callback||!e.token},get children(){return r(W,{message:"Invalid connection request. Missing required parameters.",type:"error"})}}),k,U),a(i,r(m,{get when(){return D(()=>!!e.callback)()&&e.token},get children(){return r(M,{onClick:L,get loading(){return b()},get disabled(){return d()},get children(){return D(()=>!!d())()?"Connected":b()?"Connecting...":"Connect"}})}}),v,O),a(q,()=>e.source||"unknown",H,V),a(K,()=>e.callback,Z,ee),i})()}export{pe as ConnectForm,fe as LoginForm,me as SetupForm};
